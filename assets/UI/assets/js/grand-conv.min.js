/*! grand-conv 2016-10-06 */
function download(){window.URL=window.webkitURL||window.URL;var a=document.querySelector("treeOutput"),b=ph.drawing.exportSvg(),c=new Blob([b],{type:"image/svg+xml"});downloadTree=document.createElement("a"),downloadTree.download="phylogeny.svg",downloadTree.href=window.URL.createObjectURL(c),downloadTree.dataset.downloadurl=["image/svg+xml",downloadTree.download,downloadTree.href].join(":"),downloadTree.draggable=!0,downloadTree.classList.add("dragout"),a.appendChild(downloadTree),downloadTree.onclick=function(){return"disabled"in this.dataset?!1:void setTimeout(function(){window.URL.revokeObjectURL(this.href)},1500)};var d=(document.querySelector("scatterOutput"),svgScatterPlot.draw.exportSvg({whitespace:!0})),e=new Blob([d],{type:"image/svg+xml"});downloadScatter=document.createElement("a"),downloadScatter.download="scatter.svg",downloadScatter.href=window.URL.createObjectURL(e),downloadScatter.dataset.downloadurl=["image/svg+xml",downloadScatter.download,downloadScatter.href].join(":"),downloadScatter.draggable=!0,downloadScatter.classList.add("dragout"),a.appendChild(downloadScatter),downloadScatter.onclick=function(){return"disabled"in this.dataset?!1:void setTimeout(function(){window.URL.revokeObjectURL(this.href)},1500)}}function setAttr(a,b,c){$(b).attr(c,$(a)[0].value)}function unhighlight_branches(){$(".branch").attr({stroke:"black"})}function highlight_branches(a,b){unhighlight_branches(),$("#branch"+a).attr({stroke:"#ff0000"}),$("#branch"+b).attr({stroke:"#ff0000"})}function updatePoints(){$(".nodePtr").not(".hilighted").attr({fill:"#0000ff","fill-opacity":.3,stroke:"#000000"}),$(".nodePtr.hilighted").attr({fill:"#ff0000","fill-opacity":.9,stroke:"#000000"})}function hight_singleScatterPoint(a,b){SVG.get("nodePtr"+a+"xx"+b).front(),$("#nodePtr"+a+"xx"+b).attr({fill:"#ff0000","fill-opacity":.8,stroke:"#ff0000"})}function unhight_singleScatterPoint(a,b){$("#nodePtr"+a+"xx"+b).attr({fill:"#0000ff","fill-opacity":.3,stroke:"#000000"}),$(".nodePtr.hilighted").attr({fill:"#ff0000","fill-opacity":.9,stroke:"#000000"}),regressionLine.front()}function unhighlight_scatterPoints_set(a){$(".branchPtr"+a).attr({fill:"#0000ff","fill-opacity":.3,stroke:"black"}),$(".nodePtr").not(".branchPtr"+a).attr({fill:"#0000ff","fill-opacity":.3,stroke:"#000000","stroke-opacity":1}),$(".nodePtr.hilighted").attr({fill:"#ff0000","fill-opacity":.9,stroke:"#000000"}),regressionLine.front()}function highlight_scatterPoints_set(a){$("#scatterPlot .branchPtr"+a).each(function(){this.instance.front()}),$(".branchPtr"+a).attr({fill:"#ff0000","fill-opacity":.8,stroke:"#ff0000"}),$(".nodePtr").not(".branchPtr"+a).attr({fill:"#0000ff","fill-opacity":.1,stroke:"#000000","stroke-opacity":.5}),$(".nodePtr.hilighted").attr({fill:"#ff0000","fill-opacity":.9,stroke:"#000000"})}function highlight_branches_set(a,b){$("#branch"+a).attr({stroke:"#ff0000"}),$("#branch"+b).attr({stroke:"#ff0000"}),updatePoints()}function resetZoom(){$("#phylogram #svg_root").attr("transform","matrix(1,0,0,1,0,0)")}function scatterPlot(a,b,c,d){var e=450,f=420,g=!1,h=d.xLab,i=d.yLab,j=0;d.xMin;var k=d.xMax,l=0;d.yMin;var m=d.yMax;g=null==c?!1:!0,null==k&&(k=1.01*Math.max.apply(null,a)),null==j&&(j=1.01*Math.min.apply(null,a)),null==m&&(m=1.01*Math.max.apply(null,b)),null==l&&(l=1.01*Math.min.apply(null,b));var n=70,o=30,p=10,q=10,r=e/(k-j),s=f/(m-l),t=SVG("data-plot").size("100%",540).attr({outline:0}).id("scatterPlot"),u=t.rect((k-j)*r,(m-l)*s).move(n,o).attr({fill:"#eeeeee"}).opacity(.5),v=(t.line(0+n,0+o,0+n,f+o).stroke({width:2}),t.text(i).font({family:"Helvetica",size:18}));v.center(n-5.6*p,f/2+o),v.rotate(-90);for(var w=9,x=(m-l)/w*s,y=0;w>=y;y++){t.line(0+n-8,f+o-y*x,0+n+0,f+o-y*x).stroke({width:1}),t.text((l+y*x/s).toFixed(2)).center(0+n-20,f+o-y*x+3).font({family:"Helvetica",size:12})}var z=(t.line(0+n,f+o,e+n,f+o).stroke({width:2}),t.text(h).font({family:"Helvetica",size:18}));z.center(e/2+n,f+o+4.6*q);for(var A=9,B=(k-j)/A*r,y=0;A>=y;y++){t.line(0+n+y*B,f+o-0,0+n+y*B,f+o+8).stroke({width:1}),t.text((j+y*B/r).toFixed(2)).center(0+n+y*B+2,f+o+20).font({family:"Helvetica",size:12})}var C=7;if(d.diag){calculateResiduals();var D=n+(j-j)*r,E=f-(j*regressionSlope+regressionIntercept-l)*s+o,F=n+(k-j)*r,G=f-(k*regressionSlope+regressionIntercept-l)*s+o;j*regressionSlope+regressionIntercept<l&&(D=n+((l-regressionIntercept)/regressionSlope-j)*r,E=f+o),k*regressionSlope+regressionIntercept>m&&(F=n+((m-regressionIntercept)/regressionSlope-j)*r,G=f-(m-l)*s+o),regressionLine=t.line(D,E,F,G).stroke({width:2,color:"red"}).style("stroke-dasharray","3, 3")}pointLabel=t.text("").font({family:"Helvetica",size:14}).center(e/2+n,f+100);for(var H=t.set(),I=function(){pointLabel.text("(Branches "+c[H.index(this)]+" )").center(e/2+n,f+100);var d=c[H.index(this)].split("x");highlight_branches(d[0].split("..")[1],d[1].split("..")[1]);var g=Number(c[H.index(this)].split("x")[0].split("..")[1]),h=Number(c[H.index(this)].split("x")[1].split("..")[1]);hight_singleScatterPoint(g,h),this.radius(C);{var i=this.attr("index"),k=(a[i]-j)*r+n,m=f-(b[i]-l)*s+o,p=f-(b[i]-residuals[i]-l)*s+o;t.line(k,m,k,p).stroke({width:1}).attr("id","resLine"+i)}t.ellipse(60,30).move(k-60,m-35).fill({color:"####"}).attr("id","resEllipse"+i);t.text(residuals[i].toFixed(2)).move(k-45,m+12-35).font({size:12}).fill({color:"#fff"}).attr("id","resValue"+i)},J=function(){var a=Number(c[H.index(this)].split("x")[0].split("..")[1]),b=Number(c[H.index(this)].split("x")[1].split("..")[1]);unhight_singleScatterPoint(a,b),this.radius(C/2),pointLabel.text(""),unhighlight_branches();var d=this.attr("index");SVG.get("#resLine"+d).remove(),SVG.get("#resEllipse"+d).remove(),SVG.get("#resValue"+d).remove()},K=t.set(),y=0;y<a.length;y++){var L=t.circle(C),M=c[y].split("x");L.move((a[y]-j)*r-C/2+n,f-(b[y]-l)*s-C/2+o),L.attr({fill:"#0000ff","fill-opacity":.3,stroke:"#000","stroke-width":1});var N=M[0].split("..")[1],O=M[1].split("..")[1],P=N.replace(/ /g,""),Q=O.replace(/ /g,"");P<ph.leaves.length&&Q<ph.leaves.length&&K.add(L);var R=P+"xx"+Q;L.attr("index",y),L.attr("id","nodePtr"+R),L.addClass("nodePtr"),L.addClass("branchPtr"+P),L.addClass("branchPtr"+Q),L.on("mouseover",I),L.on("mouseout",J),H.add(L),u.inside((a[y]-j)*r+n,f-(b[y]-l)*s+o)||L.hide()}return regressionLine.front(),{ylim:f,xlim:e,xMin:j,xMax:k,yMin:l,yMax:m,xTranslate:n,yTranslate:o,xScale:r,yScale:s,tiptipCompSet:K,draw:t}}function rateScatterPlot(a,b,c,d,e){var f=450,g=420,h=!1,i=d.xLab,j=d.yLab,k=0;d.xMin;var l=d.xMax,m=0;d.yMin;var n=d.yMax,o=d.ID;h=null==c?!1:!0,null==l&&(l=1.01*Math.max.apply(null,a)),null==k&&(k=1.01*Math.min.apply(null,a)),null==n&&(n=Math.max.apply(null,b)+1),null==m&&(m=Math.min.apply(null,b));var p=70,q=30,r=10,s=10,t=f/(l-k),u=g/(n-m),v=SVG(o).size("100%",540).attr({outline:0}).id(o+"-scatterPlot"),w=(v.rect((l-k)*t,(n-m)*u).move(p,q).attr({fill:"#eeeeee"}).opacity(.5),v.line(0+p,0+q,0+p,g+q).stroke({width:2}),v.text(j).font({family:"Helvetica",size:18}));w.center(p-5.6*r,g/2+q),w.rotate(-90);var x=n;1==n&&(x=5);for(var y=(n-m)/x*u,z=0;x>=z;z++){{v.line(0+p-8,g+q-z*y,0+p+0,g+q-z*y).stroke({width:1})}if(n>1){v.text((m+z*y/u).toFixed(0)).center(0+p-17,g+q-z*y+4).font({family:"Helvetica",size:12})}else{v.text((m+z*y/u).toFixed(1)).center(0+p-17,g+q-z*y+4).font({family:"Helvetica",size:12})}}var A=(v.line(0+p,g+q,f+p,g+q).stroke({width:2}),v.text(i).font({family:"Helvetica",size:18}));A.center(f/2+p,g+q+4.6*s);for(var B=Math.floor(l/10),C=(l-k)/B*t,z=0;B>=z;z++){v.line(0+p+z*C,g+q-0,0+p+z*C,g+q+8).stroke({width:1}),v.text((k+z*C/t).toFixed(2)).center(0+p+z*C+2,g+q+20).font({family:"Helvetica",size:12})}var D=7;if(d.diag){calculateResiduals();var E=p+(k-k)*t,F=g-(k*regressionSlope+regressionIntercept-m)*u+q,G=p+(l-k)*t,H=g-(l*regressionSlope+regressionIntercept-m)*u+q;k*regressionSlope+regressionIntercept<m&&(E=p+((m-regressionIntercept)/regressionSlope-k)*t,F=g+q),l*regressionSlope+regressionIntercept>n&&(G=p+((n-regressionIntercept)/regressionSlope-k)*t,H=g-(n-m)*u+q),regressionLine=v.line(E,F,G,H).stroke({width:2,color:"red"}).style("stroke-dasharray","3, 3")}circlesToBringToFront=[],crclIdx=0;for(var z=0;z<b.length;z++){var I=v.circle(D);I.move((a[z]-k)*t-D/2+p,g-(b[z]-m)*u-D/2+q),null!=e?"#0000ff"!=e[z]?(circlesToBringToFront[crclIdx]=z,crclIdx++):I.attr({fill:e[z],"fill-opacity":.3,stroke:"#000","stroke-width":1}):I.attr({fill:"#0000ff","fill-opacity":.3,stroke:"#000","stroke-width":1})}if(console.log(circlesToBringToFront.length),null!=e)for(var z=0;z<circlesToBringToFront.length;z++){var J=circlesToBringToFront[z],I=v.circle(D);I.move((a[J]-k)*t-D/2+p,g-(b[J]-m)*u-D/2+q),I.attr({fill:e[J],"fill-opacity":1,stroke:"#000","stroke-width":1})}return{ylim:g,xlim:f,xMin:k,xMax:l,yMin:m,yMax:n,xTranslate:p,yTranslate:q,xScale:t,yScale:u,draw:v}}function barPlots(a){var b=1050,c=200,d=a.yLab,e=a.xMin,f=a.xMax,g=a.yMin,h=a.yMax,i=a.dataSet,j=a.id,k=a.id.split("-")[0].split("_")[1].split("x")[0],l=a.id.split("-")[0].split("_")[1].split("x")[1];for(null==f&&(f=numOfSites);f%10!=0;)f++;for(null==e&&(e=0);e%10!=0;)e--;null==h&&(h=1),null==g&&(g=0);var m=70,n=30,o=10,p=b/(f-e),q=c/(h-g),r=SVG(j).size("100%",250).attr({outline:0}),s=r.rect((f-e)*p,(h-g)*q).move(m,n).attr({fill:"#eeeeee"}).opacity(.5).mouseover(function(){window.opener.highlight_branches(k,l),window.opener.hight_singleScatterPoint(k,l)}).mouseout(function(){window.opener.unhighlight_branches(),window.opener.unhight_singleScatterPoint(k,l)}),t=(r.line(0+m,0+n,0+m,c+n).stroke({width:2}),r.text(d).font({family:"Helvetica",size:18}));t.center(m-5.6*o,c/2+n),t.rotate(-90);for(var u=9,v=(h-g)/u*q,w=0;u>=w;w++){r.line(0+m-8,c+n-w*v,0+m+0,c+n-w*v).stroke({width:1}),r.text((g+w*v/q).toFixed(2)).center(0+m-20,c+n-w*v+3).font({family:"Helvetica",size:12})}for(var x=(r.line(0+m,c+n,b+m,c+n).stroke({width:2}),10),y=Math.round((f-e)/x*p),w=0;x>=w;w++){r.line(m+w*y,c+n,m+w*y,c+n+8).stroke({width:1}),r.text((e+w*y/p).toFixed(0)).center(m+w*y+2,c+n+20).font({family:"Helvetica",size:12})}for(var z,A,B=r.set(),C=r.set(),w=0;w<i.length;w++)0==i[w][0]?(z=r.rect(p,i[w][2]*q),z.move((i[w][0]-e)*p+m,c-(i[w][2]-g)*q+n),A=r.rect(p,i[w][1]*q),A.move((i[w][0]-e)*p+m,c-(i[w][1]-g)*q+n)):i[w][0]==f?(z=r.rect(p,i[w][2]*q),z.move((i[w][0]-e)*p-p/2+m,c-(i[w][2]-g)*q+n),A=r.rect(p,i[w][1]*q),A.move((i[w][0]-e)*p-p/2+m,c-(i[w][1]-g)*q+n)):(z=r.rect(p,i[w][2]*q),z.move((i[w][0]-e)*p-p/2+m,c-(i[w][2]-g)*q+n),A=r.rect(p,i[w][1]*q),A.move((i[w][0]-e)*p-p/2+m,c-(i[w][1]-g)*q+n)),z.addClass("probConvBar"+j),z.attr("id","probConvBar"+j+"_"+i[w][0]),z.attr({fill:"black","fill-opacity":1,stroke:"#000","stroke-width":1}),A.attr({fill:"green","fill-opacity":.5}),s.inside((i[w][0]-e)*p-p/2+m,c-(i[w][2]-g)*q+n)||0==w||z.hide(),s.inside((i[w][0]-e)*p-p/2+m,c-(i[w][1]-g)*q+n)||0==w||A.hide(),B.add(z),C.add(A);return C.hide(),{convSet:B,divSet:C,exportSvg:r.exportSvg()}}function phyloPlot(){Phylogram.tree=tree,ph=Phylogram.draw("data-tree",{width:500,height:480}),setAttr("#labelSize",".leafLabel","font-size"),setAttr("#branchThickness",".branch","stroke-width"),$("#phylogram").svgPan("svg_root")}function drawTable(){calculateResiduals();for(var a=new Array(xPoints.length),b=0;b<xPoints.length;b++)a[b]=new Array(4),a[b][0]=labels[b],a[b][1]=yPoints[b],a[b][2]=xPoints[b],a[b][3]=0!=xPoints[b]?yPoints[b]/xPoints[b]:1/0,a[b][3]=residuals[b];$("#ssheet").html('<table cellpadding="0" cellspacing="0" border="0" class="display" id="datatable"></table>');var c=$("#datatable").DataTable({data:a,columns:[{title:"Branch Pair"},{title:"Convergence","class":"center"},{title:"Divergence","class":"center"},{title:"Residual","class":"center"}]});null==window.chrome&&(window.opener.$("#slopeInputField").change(function(){for(var a=0;a<residuals.length;a++){var b=c.row(a).data();b[3]=window.opener.residuals[a],c.row(a).data(b)}}),window.opener.$("#interceptInputField").change(function(){for(var a=0;a<residuals.length;a++){var b=c.row(a).data();b[3]=window.opener.residuals[a],c.row(a).data(b)}})),$("#datatable tbody").on("mouseover","tr",function(){var a=$(this).closest("tr"),b=c.row(a),d=b.data(),e=d[0].split("x"),f=e[0].split("..")[1],g=e[1].split("..")[1],h=f.replace(/ /g,""),i=g.replace(/ /g,""),j=h+"xx"+i;window.opener.updatePoints(),window.opener.$("#nodePtr"+j).attr({fill:"#ffff00",stroke:"#000000","fill-opacity":1}),window.opener.highlight_branches(h,i)}),$("#datatable tbody").on("mouseout","tr",function(){window.opener.updatePoints(),window.opener.unhighlight_branches()});var d=!1;$("#datatable tbody").on("click","tr",function(a){if(d||(d=this),a.shiftKey){var e=$("#datatable tbody tr").index(this),f=$("#datatable tbody tr").index(d);for(b=Math.min(e,f)+1;b<=Math.max(e,f);b++){$("#datatable tbody tr").eq(b).hasClass("selected")?$("#datatable tbody tr").eq(b).removeClass("selected"):$("#datatable tbody tr").eq(b).addClass("selected");var g=$("#datatable tbody tr").eq(b),h=c.row(g),i=h.data(),j=i[0].split("x"),k=j[0].split("..")[1],l=j[1].split("..")[1],m=k.replace(/ /g,""),n=l.replace(/ /g,""),o=m+"xx"+n,p=window.opener.$("#nodePtr"+o).attr("class");-1!=p.search("hilighted")?p=p.replace(/ hilighted/g,""):p+=" hilighted",window.opener.$("#nodePtr"+o).attr({"class":p}),window.opener.highlight_branches_set(m,n)}window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}else if(a.metaKey||a.ctrlKey)$(this).toggleClass("selected");else{$(this).toggleClass("selected");var h=c.row(this),i=h.data(),j=i[0].split("x"),k=j[0].split("..")[1],l=j[1].split("..")[1],m=k.replace(/ /g,""),n=l.replace(/ /g,""),o=m+"xx"+n,p=window.opener.$("#nodePtr"+o).attr("class");-1!=p.search("hilighted")?p=p.replace(/ hilighted/g,""):p+=" hilighted",window.opener.$("#nodePtr"+o).attr({"class":p}),window.opener.highlight_branches_set(m,n)}d=this})}function loadSiteSpecific(){for(var a=function(a,b){$("#"+siteSpecificBranchPairsIDs[b]+" tbody").on("mouseover","tr",function(){var c=a.row(this),d=c.data()[0];$("#probConvBar"+siteSpecificBranchPairsIDs[b]+"-barPlot_"+d).attr({fill:"red","fill-opacity":1,stroke:"red","stroke-width":1}),SVG.get("probConvBar"+siteSpecificBranchPairsIDs[b]+"-barPlot_"+d).front()})},b=function(a,b){$("#"+siteSpecificBranchPairsIDs[b]+" tbody").on("mouseout","tr",function(){var c=a.row(this),d=c.data()[0];$("#probConvBar"+siteSpecificBranchPairsIDs[b]+"-barPlot_"+d).attr({fill:"black","fill-opacity":1,stroke:"#000","stroke-width":1})})},c=0;c<numOfSelectedBranchPairs;c++){var d=barPlots({xLab:"",yLab:"Convergent Probability",yMin:null,yMax:null,xMin:0,xMax:numOfSites,dataSet:siteSpecificBranchPairs[c],id:siteSpecificBranchPairsIDs[c]+"-barPlot"});barPlotsSet[c]=d,$("#"+siteSpecificBranchPairsIDs[c]+"-sheet").html("<table id="+siteSpecificBranchPairsIDs[c]+' class="display" cellspacing="0" width="100%"></table>');var e=$("#"+siteSpecificBranchPairsIDs[c]).DataTable({data:siteSpecificBranchPairs[c],columns:[{title:"Site"},{title:"Probability of Divergence","class":"center"},{title:"Probability of Convergence","class":"center"}]});e.on("mouseover",a(e,c)),e.on("mouseout",b(e,c))}}function main(){phyloPlot(),homePage=this,svgScatterPlot=scatterPlot(xPoints,yPoints,labels,{xLab:"Divergent substitutions",yLab:"Convergent substitutions",yMin:null,yMax:null,xMin:null,xMax:null,diag:!0}),document.getElementById("slopeInputField").value=regressionSlope,document.getElementById("interceptInputField").value=regressionIntercept,$("#phylogram").click(function(a){a.metaKey&&(download(),downloadTree.click(),downloadScatter.click()),a.ctrlKey&&(download(),downloadTree.click(),downloadScatter.click())}),$("#data-plot").click(function(a){a.metaKey&&(download(),downloadTree.click(),downloadScatter.click()),a.ctrlKey&&(download(),downloadTree.click(),downloadScatter.click())})}function generateRateVsDiversityPlot(){homePage=this;var a=[0],b=[0],c=[0],d=null,e=0;if(numOfSelectedBranchPairs>0)var f=siteSpecificBranchPairs[0],d=[""];for(var g=0;g<ySiteClass.length;g++)ySiteClass[g]>0&&(a[e]=ySiteClass[g],b[e]=xPostNumSub[g],c[e]=g,e+=1);if(numOfSelectedBranchPairs>0)for(var h=0,g=0;g<c.length;g++){for(var i=c[g];f[h][0]<i;)h++;d[g]=f[h][0]==i?f[h][2]>.8?"#ff0000":f[h][2]>.5?"#ff8100":"#0000ff":"#0000ff"}svgScatterPlot=rateScatterPlot(b,a,null,{xLab:"Posterior number of substitutions",yLab:"Amino-acid diversity",yMin:null,yMax:null,xMin:null,xMax:null,diag:!1,ID:"data-plot"},d),$("#data-plot").click(function(a){a.metaKey&&(download(),downloadTree.click(),downloadScatter.click()),a.ctrlKey&&(download(),downloadTree.click(),downloadScatter.click())})}function generateRateVsProbConvergencePlot(){homePage=this;for(var a=0;a<numOfSelectedBranchPairs;a++){for(var b=siteSpecificBranchPairs[a],c=[0],d=[0],e=0;e<b.length;e++)c[e]=b[e][2],d[e]=xPostNumSub[b[e][0]];svgScatterPlot=rateScatterPlot(d,c,null,{xLab:"Posterior number of substitutions",yLab:"p(Convergence)",yMin:null,yMax:1,xMin:null,xMax:null,diag:!1,ID:siteSpecificBranchPairsIDs[a]+"-data-plot"},null),rateVsProbConvPlotsSet[a]=svgScatterPlot}}function showTipTip(){document.getElementById("hideTipTipButton").disabled=!1,document.getElementById("showTipTipButton").disabled=!0,svgScatterPlot.tiptipCompSet.show()}function hideTipTip(){document.getElementById("hideTipTipButton").disabled=!0,document.getElementById("showTipTipButton").disabled=!1,svgScatterPlot.tiptipCompSet.hide()}function showDivergence(){document.getElementById("hideDivergenceButton").disabled=!1,document.getElementById("showDivergenceButton").disabled=!0;for(var a=0;a<numOfSelectedBranchPairs;a++)barPlotsSet[a].divSet.show()}function hideDivergence(){document.getElementById("hideDivergenceButton").disabled=!0,document.getElementById("showDivergenceButton").disabled=!1;for(var a=0;a<numOfSelectedBranchPairs;a++)barPlotsSet[a].divSet.hide()}function calculateResiduals(){residuals=new Array(xPoints.length);for(var a=0;a<xPoints.length;a++)residuals[a]=yPoints[a]-xPoints[a]*regressionSlope-regressionIntercept}function updateScatterPlot(){var a,b,c,d;a=""!=document.getElementById("xMinInputField").value?Number(document.getElementById("xMinInputField").value):null,b=""!=document.getElementById("xMaxInputField").value?Number(document.getElementById("xMaxInputField").value):null,c=""!=document.getElementById("yMinInputField").value?Number(document.getElementById("yMinInputField").value):null,d=""!=document.getElementById("yMaxInputField").value?Number(document.getElementById("yMaxInputField").value):null,$("#scatterPlot").remove(),svgScatterPlot=scatterPlot(xPoints,yPoints,labels,{xLab:"Divergent substitutions",yLab:"Convergent substitutions",yMin:c,yMax:d,xMin:a,xMax:b,diag:!0})}function updateRegressionLine(){""!=document.getElementById("slopeInputField").value&&(regressionSlope=Number(document.getElementById("slopeInputField").value)),""!=document.getElementById("interceptInputField").value&&(regressionIntercept=Number(document.getElementById("interceptInputField").value)),calculateResiduals();var a=svgScatterPlot.xTranslate,b=svgScatterPlot.ylim-(svgScatterPlot.xMin*regressionSlope+regressionIntercept-svgScatterPlot.yMin)*svgScatterPlot.yScale+svgScatterPlot.yTranslate;x1=svgScatterPlot.xTranslate+(svgScatterPlot.xMax-svgScatterPlot.xMin)*svgScatterPlot.xScale,y1=svgScatterPlot.ylim-(svgScatterPlot.xMax*regressionSlope+regressionIntercept-svgScatterPlot.yMin)*svgScatterPlot.yScale+svgScatterPlot.yTranslate,svgScatterPlot.xMin*regressionSlope+regressionIntercept<svgScatterPlot.yMin&&(a=svgScatterPlot.xTranslate+((svgScatterPlot.yMin-regressionIntercept)/regressionSlope-svgScatterPlot.xMin)*svgScatterPlot.xScale,b=svgScatterPlot.ylim+svgScatterPlot.yTranslate),svgScatterPlot.xMax*regressionSlope+regressionIntercept>svgScatterPlot.yMax&&(x1=svgScatterPlot.xTranslate+((svgScatterPlot.yMax-regressionIntercept)/regressionSlope-svgScatterPlot.xMin)*svgScatterPlot.xScale,y1=svgScatterPlot.ylim-(svgScatterPlot.yMax-svgScatterPlot.yMin)*svgScatterPlot.yScale+svgScatterPlot.yTranslate),regressionLine.plot(a,b,x1,y1)}var ph,svgScatterPlot,tabWin,downloadTree,downloadScatter,regressionLine,residuals,barPlotsSet=new Array(numOfSelectedBranchPairs),rateVsProbConvPlotsSet=new Array(numOfSelectedBranchPairs),strWindowFeatures="menubar=no,location=no,resizable=yes,scrollbars=yes,status=no,width=800,height=500";jQuery.fn.dataTableExt.oApi.fnDisplayRow=function(a,b){if(-1!=a._iDisplayLength){for(var c=-1,d=0,e=a.aiDisplay.length;e>d;d++)if(a.aoData[a.aiDisplay[d]].nTr==b){c=d;break}c>=0&&(a._iDisplayStart=Math.floor(d/a._iDisplayLength)*a._iDisplayLength,this.oApi._fnCalculateEnd&&this.oApi._fnCalculateEnd(a)),this.oApi._fnDraw(a)}},function(){function a(a){return!a.hasOwnProperty("children")}function b(b){function c(b){for(var e in b.children){var f=b.children[e];d.push(f),a(f)||c(f)}}var d=[b];return c(b),d}function c(b){function c(b){var d=0;if(a(b))return b.length;for(var e in b.children){var f=b.children[e],g=c(f);g>d&&(d=g)}return d+b.length}return c(b)}Phylogram={},Phylogram.draw=function(d,e){function f(a){for(t in a.children){var b=a.children[t];b.hasOwnProperty("plot_y")||f(b)}a.plot_y=(a.children[0].plot_y+a.children[a.children.length-1].plot_y)/2}function g(a,b){for(t in a.children){var c=a.children[t];g(c,b+a.length*r)}a.plot_x=b+a.length*r}var h=b(this.tree),i=h.filter(a),j=20,k=e.height/i.length,l=SVG(d).size(e.width+2*j,e.height+3*j).id("phylogram"),m=l.group().id("svg_root"),n=0;for(t in i){var o=i[t];o.plot_y=t*k+k/2+2*j,o.text_label=l.text(o.name);var p=o.text_label.length();p>n&&(n=p),m.add(o.text_label)}{var q=c(this.tree),r=(e.width-n)/q;(e.width-n)/20}f(this.tree),g(this.tree,j);var s=l.set();for(var t in h){var u=h[t];for(var v in u.children){var w=u.children[v],x=l.polyline([[u.plot_x,u.plot_y],[u.plot_x,w.plot_y],[w.plot_x,w.plot_y]]).fill("none").stroke("black").attr("id","branch"+w.id).data("pid",u.id).addClass("branch");if(m.add(x),x.mouseover(function(){this.attr({stroke:"#e94d10"});var a=this.id(),b=this.data("pid");a=a.replace("branch",""),a=a.replace(/ /g,"");var c=this.array.value[0][0],d=this.array.value[0][1];highlight_scatterPoints_set(a);ph.drawing.ellipse(60,30).move(c-20,d).fill({color:"####"}).attr("id","branchEllipse"+a),ph.drawing.text(b+".."+a).move(c-8,d+10).font({size:12}).fill({color:"#fff"}).attr("id","branchIdText"+a);m.add(SVG.get("branchEllipse"+a)),m.add(SVG.get("branchIdText"+a))}),x.mouseout(function(){this.attr({stroke:"black"});var a=this.id();a=a.replace("branch",""),a=a.replace(/ /g,""),unhighlight_scatterPoints_set(a),SVG.get("#branchEllipse"+a).remove(),SVG.get("#branchIdText"+a).remove()}),a(w)){var y=w.text_label.length();w.text_label.center(w.plot_x,w.plot_y).dx(y/2+j).font({family:"Helvetica",size:14}).addClass("leafLabel").front()}s.add(x)}}return{drawing:l,lineSet:s,max_label_size:n,leaves:i}}}();